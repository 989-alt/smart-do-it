<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart, Do-it! - Todo App</title>
    <meta name="description" content="Smart, Do-it! - ìŠ¤ë§ˆíŠ¸í•œ í•  ì¼ ê´€ë¦¬ ì•±">
    <link rel="stylesheet" href="./style.css">
    
    <!-- Firebase SDK (ê°„ë‹¨í•œ ë²„ì „) -->
    <script type="module">
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDEwiVaWkx9VW1w2Myp0CDYsonqKhWUwXo",
            authDomain: "to-do-list-8f53a.firebaseapp.com",
            projectId: "to-do-list-8f53a",
            storageBucket: "to-do-list-8f53a.firebasestorage.app",
            messagingSenderId: "1003134105451",
            appId: "1:1003134105451:web:b09e5ba0a1212b26f27e2e",
            measurementId: "G-1XBV811RNM"
        };

        // Firebase ì´ˆê¸°í™” ë° API ì„¤ì •
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            
            console.log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ');
            
            // Firebase API ì„¤ì •
            window.firebaseAPI = {
                auth: auth,
                db: db,
                
                async registerUser(username, password) {
                    try {
                        const email = `${username}@smarttodo.local`;
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        
                        await setDoc(doc(db, 'users', userCredential.user.uid), {
                            username: username,
                            email: email,
                            todos: [],
                            createdAt: serverTimestamp(),
                            lastUpdated: serverTimestamp()
                        });
                        
                        return { success: true, message: 'íšŒì›ê°€ì… ì„±ê³µ!' };
                    } catch (error) {
                        console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                        if (error.code === 'auth/email-already-in-use') {
                            throw new Error('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.');
                        } else if (error.code === 'auth/weak-password') {
                            throw new Error('ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤.');
                        } else {
                            throw new Error(`íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                        }
                    }
                },
                
                async loginUser(username, password) {
                    try {
                        const email = `${username}@smarttodo.local`;
                        const userCredential = await signInWithEmailAndPassword(auth, email, password);
                        
                        const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));
                        const userData = userDoc.data();
                        
                        return {
                            success: true,
                            message: 'ë¡œê·¸ì¸ ì„±ê³µ!',
                            user: {
                                uid: userCredential.user.uid,
                                username: userData.username,
                                email: email,
                                todos: userData.todos || []
                            }
                        };
                    } catch (error) {
                        console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                            throw new Error('ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        } else {
                            throw new Error(`ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                        }
                    }
                },
                
                async logoutUser() {
                    try {
                        await signOut(auth);
                        return { success: true };
                    } catch (error) {
                        throw new Error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                
                async saveUserTodos(uid, todos) {
                    try {
                        await updateDoc(doc(db, 'users', uid), {
                            todos: todos,
                            lastUpdated: serverTimestamp()
                        });
                        return { success: true };
                    } catch (error) {
                        throw new Error('í•  ì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                
                async getUserTodos(uid) {
                    try {
                        const userDoc = await getDoc(doc(db, 'users', uid));
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            return {
                                success: true,
                                todos: userData.todos || []
                            };
                        } else {
                            throw new Error('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        throw new Error('í•  ì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                
                onAuthStateChanged(callback) {
                    return onAuthStateChanged(auth, callback);
                }
            };
            
        } catch (error) {
            console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            window.firebaseAPI = {
                error: 'Firebase ì´ˆê¸°í™” ì‹¤íŒ¨',
                message: error.message
            };
        }
    </script>
</head>
<body>
    <!-- ë©”ì¸ ì•± í™”ë©´ -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <header class="header">
                <h1>ğŸ“ Smart, Do-it!</h1>
                <div class="header-controls">
                    <!-- ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœ -->
                    <div id="guestControls" class="auth-controls">
                        <button id="loginBtn" class="auth-btn-header">ë¡œê·¸ì¸</button>
                        <button id="registerBtn" class="auth-btn-header">íšŒì›ê°€ì…</button>
                        <button id="forgotPasswordBtn" class="auth-btn-header forgot-btn-header">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
                    </div>
                    
                    <!-- ë¡œê·¸ì¸ëœ ìƒíƒœ -->
                    <div id="userInfo" class="user-info" style="display: none;">
                        <span id="userName"></span>
                        <button id="logoutBtn" class="auth-btn-header">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>
                    
                    <!-- í…Œë§ˆ í† ê¸€ -->
                    <button id="themeToggleMain" class="theme-toggle">ğŸŒ™</button>
                </div>
            </header>

            <!-- ë·° ì „í™˜ íƒ­ -->
            <div class="view-tabs">
                <button class="view-tab active" data-view="list">ğŸ“‹ ëª©ë¡</button>
                <button class="view-tab" data-view="calendar">ğŸ“… ìº˜ë¦°ë”</button>
            </div>

            <!-- ëª©ë¡ ë·° -->
            <div id="listView" class="view-content active">
                <!-- ì…ë ¥ ì„¹ì…˜ -->
                <div class="input-section">
                    <form id="todoForm" class="todo-form">
                        <div class="input-group">
                            <input type="text" id="todoInput" placeholder="ìƒˆë¡œìš´ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..." required>
                            <button type="submit" class="add-btn">ì¶”ê°€</button>
                        </div>
                        <div class="input-options">
                            <select id="prioritySelect">
                                <option value="normal">ë³´í†µ</option>
                                <option value="high">ë†’ìŒ</option>
                                <option value="urgent">ê¸´ê¸‰</option>
                            </select>
                            <input type="date" id="dueDate">
                            <select id="categorySelect">
                                <option value="general">ì¼ë°˜</option>
                                <option value="work">ì—…ë¬´</option>
                                <option value="personal">ê°œì¸</option>
                                <option value="health">ê±´ê°•</option>
                            </select>
                        </div>
                    </form>
                </div>

                <!-- í•  ì¼ ëª©ë¡ -->
                <div class="todos-container">
                    <div class="todo-section">
                        <h2>ğŸ“‹ ì˜ˆì •ëœ í•  ì¼</h2>
                        <ul id="pendingList" class="todo-list"></ul>
                    </div>
                    <div class="todo-section">
                        <h2>âœ… ì™„ë£Œëœ í•  ì¼</h2>
                        <ul id="completedList" class="todo-list"></ul>
                    </div>
                </div>
            </div>

            <!-- ìº˜ë¦°ë” ë·° -->
            <div id="calendarView" class="view-content">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button id="prevMonth" class="calendar-nav-btn">â€¹</button>
                        <h2 id="currentMonthYear"></h2>
                        <button id="nextMonth" class="calendar-nav-btn">â€º</button>
                    </div>
                    <div id="calendarGrid" class="calendar-grid"></div>
                </div>
                
                <!-- ì„ íƒëœ ë‚ ì§œì˜ í•  ì¼ -->
                <div id="selectedDateInfo" class="selected-date-info" style="display: none;">
                    <h3 id="selectedDateTitle"></h3>
                    <div class="date-todos">
                        <div class="date-todo-section">
                            <h4>ğŸ“‹ ì˜ˆì •ëœ í•  ì¼</h4>
                            <ul id="datePendingList" class="date-todo-list"></ul>
                        </div>
                        <div class="date-todo-section">
                            <h4>âœ… ì™„ë£Œëœ í•  ì¼</h4>
                            <ul id="dateCompletedList" class="date-todo-list"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¸ì¦ ëª¨ë‹¬ -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <h2 id="authModalTitle">ë¡œê·¸ì¸</h2>
                <button id="closeAuthModal" class="close-btn">Ã—</button>
            </div>
            
            <div id="authMessage" class="auth-message"></div>
            
            <!-- ë¡œê·¸ì¸ í¼ -->
            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="loginUsername">ì•„ì´ë””</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="auth-submit-btn">ë¡œê·¸ì¸</button>
            </form>
            
            <!-- íšŒì›ê°€ì… í¼ -->
            <form id="registerForm" class="auth-form" style="display: none;">
                <div class="form-group">
                    <label for="registerUsername">ì•„ì´ë””</label>
                    <input type="text" id="registerUsername" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="registerPassword" required minlength="4">
                    <small>ìµœì†Œ 4ì ì´ìƒ</small>
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="registerConfirmPassword" required>
                </div>
                <button type="submit" class="auth-submit-btn">íšŒì›ê°€ì…</button>
            </form>
            
            <!-- ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í¼ -->
            <form id="forgotPasswordForm" class="auth-form" style="display: none;">
                <div class="form-group">
                    <label for="forgotUsername">ì•„ì´ë””</label>
                    <input type="text" id="forgotUsername" required>
                </div>
                <button type="submit" class="auth-submit-btn">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
            </form>
        </div>
    </div>

    <!-- í•˜ìœ„ ì‘ì—… ëª¨ë‹¬ -->
    <div id="subtaskModal" class="subtask-modal">
        <div class="subtask-modal-content">
            <div class="subtask-modal-header">
                <h3 id="subtaskModalTitle">í•˜ìœ„ ì‘ì—…</h3>
                <button id="closeSubtaskModal" class="close-btn">Ã—</button>
            </div>
            <div class="subtask-list" id="subtaskList"></div>
            <div class="subtask-input">
                <input type="text" id="subtaskInput" placeholder="ìƒˆë¡œìš´ í•˜ìœ„ ì‘ì—…...">
                <button id="addSubtask" class="add-subtask-btn">ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <script src="./script.js"></script>
</body>
</html>
