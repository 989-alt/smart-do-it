<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart, Do-it! - Todo App</title>
    <meta name="description" content="Smart, Do-it! - 스마트한 할 일 관리 앱">
    <link rel="stylesheet" href="./style.css">
    <link rel="preload" href="./style.css" as="style">
    <link rel="preload" href="./script.js" as="script">
    
    <!-- Firebase 설정 안내 -->
    <!--
    실제 Firebase 프로젝트 설정 방법:
    1. https://console.firebase.google.com/ 에서 새 프로젝트 생성
    2. Authentication > Sign-in method > 이메일/비밀번호 활성화
    3. Firestore Database > 데이터베이스 만들기
    4. 프로젝트 설정 > 웹 앱 추가 > 설정 복사
    5. 아래 firebaseConfig를 실제 설정으로 교체
    -->
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase 설정 (깃허브 배포용 - 직접 설정)
        const firebaseConfig = {
            apiKey: "AIzaSyDEwiVaWkx9VW1w2Myp0CDYsonqKhWUwXo",
            authDomain: "to-do-list-8f53a.firebaseapp.com",
            projectId: "to-do-list-8f53a",
            storageBucket: "to-do-list-8f53a.firebasestorage.app",
            messagingSenderId: "1003134105451",
            appId: "1:1003134105451:web:b09e5ba0a1212b26f27e2e",
            measurementId: "G-1XBV811RNM"
        };

        // Firebase 설정 검증
        console.log('🔍 Firebase 설정 확인:', {
            apiKey: firebaseConfig.apiKey ? '설정됨' : '누락',
            authDomain: firebaseConfig.authDomain,
            projectId: firebaseConfig.projectId,
            hasMeasurementId: !!firebaseConfig.measurementId
        });

        // Firebase 초기화
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log('✅ Firebase 초기화 성공');
            console.log('📊 프로젝트 정보:', {
                projectId: app.options.projectId,
                authDomain: app.options.authDomain
            });
        } catch (error) {
            console.error('❌ Firebase 초기화 실패:', error);
            console.error('🔍 오류 상세 정보:', {
                code: error.code,
                message: error.message,
                stack: error.stack
            });
            
            // Firebase 초기화 실패 시 폴백 처리
            window.firebaseAPI = {
                error: 'Firebase 초기화 실패',
                message: 'Firebase 설정을 확인해주세요.',
                details: error.message
            };
        }

        // Firebase API 래퍼 (초기화 성공한 경우에만)
        if (app && auth && db) {
            window.firebaseAPI = {
                auth: auth,
                db: db,
            
            // 사용자 등록 (이메일 형식으로 변환하여 처리)
            async registerUser(username, password) {
                try {
                    // username을 이메일 형식으로 변환
                    const email = `${username}@smarttodo.local`;
                    
                    // Firebase Auth로 사용자 생성
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    
                    // Firestore에 사용자 정보 저장
                    await setDoc(doc(db, 'users', userCredential.user.uid), {
                        username: username,
                        email: email,
                        todos: [],
                        createdAt: serverTimestamp(),
                        lastUpdated: serverTimestamp()
                    });
                    
                    return { 
                        success: true, 
                        message: '회원가입 성공!',
                        user: {
                            uid: userCredential.user.uid,
                            username: username,
                            email: email
                        }
                    };
                } catch (error) {
                    console.error('회원가입 오류:', error);
                    console.error('오류 코드:', error.code);
                    console.error('오류 메시지:', error.message);
                    
                    if (error.code === 'auth/api-key-not-valid') {
                        throw new Error('Firebase API 키가 유효하지 않습니다. Firebase Console에서 API 키를 확인해주세요.');
                    } else if (error.code === 'auth/email-already-in-use') {
                        throw new Error('이미 존재하는 사용자명입니다.');
                    } else if (error.code === 'auth/weak-password') {
                        throw new Error('비밀번호가 너무 약합니다.');
                    } else if (error.code === 'auth/invalid-email') {
                        throw new Error('사용자명 형식이 올바르지 않습니다.');
                    } else if (error.code === 'auth/operation-not-allowed') {
                        throw new Error('이메일/비밀번호 인증이 비활성화되어 있습니다.');
                    } else if (error.code === 'auth/network-request-failed') {
                        throw new Error('네트워크 연결을 확인해주세요.');
                    } else if (error.code === 'auth/project-not-found') {
                        throw new Error('Firebase 프로젝트를 찾을 수 없습니다. 프로젝트 ID를 확인해주세요.');
                    } else {
                        throw new Error(`회원가입 중 오류가 발생했습니다: ${error.message}`);
                    }
                }
            },
            
            // 사용자 로그인
            async loginUser(username, password) {
                try {
                    const email = `${username}@smarttodo.local`;
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    
                    // Firestore에서 사용자 정보 가져오기
                    const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));
                    const userData = userDoc.data();
                    
                    return {
                        success: true,
                        message: '로그인 성공!',
                        user: {
                            uid: userCredential.user.uid,
                            username: userData.username,
                            email: email,
                            todos: userData.todos || []
                        }
                    };
                } catch (error) {
                    console.error('로그인 오류:', error);
                    console.error('오류 코드:', error.code);
                    console.error('오류 메시지:', error.message);
                    
                    if (error.code === 'auth/api-key-not-valid') {
                        throw new Error('Firebase API 키가 유효하지 않습니다. Firebase Console에서 API 키를 확인해주세요.');
                    } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                        throw new Error('사용자명 또는 비밀번호가 올바르지 않습니다.');
                    } else if (error.code === 'auth/invalid-email') {
                        throw new Error('사용자명 형식이 올바르지 않습니다.');
                    } else if (error.code === 'auth/user-disabled') {
                        throw new Error('비활성화된 계정입니다.');
                    } else if (error.code === 'auth/too-many-requests') {
                        throw new Error('너무 많은 로그인 시도가 있었습니다. 잠시 후 다시 시도해주세요.');
                    } else if (error.code === 'auth/network-request-failed') {
                        throw new Error('네트워크 연결을 확인해주세요.');
                    } else if (error.code === 'auth/project-not-found') {
                        throw new Error('Firebase 프로젝트를 찾을 수 없습니다. 프로젝트 ID를 확인해주세요.');
                    } else {
                        throw new Error(`로그인 중 오류가 발생했습니다: ${error.message}`);
                    }
                }
            },
            
            // 로그아웃
            async logoutUser() {
                try {
                    await signOut(auth);
                    return { success: true };
                } catch (error) {
                    console.error('로그아웃 오류:', error);
                    throw new Error('로그아웃 중 오류가 발생했습니다.');
                }
            },
            
            // 사용자 할 일 저장
            async saveUserTodos(uid, todos) {
                try {
                    await updateDoc(doc(db, 'users', uid), {
                        todos: todos,
                        lastUpdated: serverTimestamp()
                    });
                    return { success: true };
                } catch (error) {
                    console.error('할 일 저장 오류:', error);
                    throw new Error('할 일 저장 중 오류가 발생했습니다.');
                }
            },
            
            // 사용자 할 일 불러오기
            async getUserTodos(uid) {
                try {
                    const userDoc = await getDoc(doc(db, 'users', uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        return {
                            success: true,
                            todos: userData.todos || []
                        };
                    } else {
                        throw new Error('사용자 정보를 찾을 수 없습니다.');
                    }
                } catch (error) {
                    console.error('할 일 불러오기 오류:', error);
                    throw new Error('할 일 불러오기 중 오류가 발생했습니다.');
                }
            },
            
            // 인증 상태 변경 감지
            onAuthStateChanged(callback) {
                return onAuthStateChanged(auth, callback);
            },
            
            // 서버 상태 확인
            async getServerStatus() {
                try {
                    // 현재 인증된 사용자 정보
                    const currentUser = auth.currentUser;
                    return {
                        serverType: 'Firebase Firestore',
                        isConnected: true,
                        currentUser: currentUser ? {
                            uid: currentUser.uid,
                            email: currentUser.email
                        } : null,
                        note: '✅ 실제 서버에 저장되며, 페이지를 새로고침해도 데이터가 유지됩니다.'
                    };
                } catch (error) {
                    return {
                        serverType: 'Firebase Firestore',
                        isConnected: false,
                        error: error.message,
                        note: '❌ 서버 연결에 문제가 있습니다.'
                    };
                }
            }
        };
        } else {
            // Firebase 초기화 실패 시 에러 API 제공
            window.firebaseAPI = {
                error: 'Firebase 초기화 실패',
                message: 'Firebase 설정을 확인해주세요.',
                async registerUser() {
                    throw new Error('Firebase가 초기화되지 않았습니다. 설정을 확인해주세요.');
                },
                async loginUser() {
                    throw new Error('Firebase가 초기화되지 않았습니다. 설정을 확인해주세요.');
                },
                async logoutUser() {
                    throw new Error('Firebase가 초기화되지 않았습니다. 설정을 확인해주세요.');
                },
                async saveUserTodos() {
                    throw new Error('Firebase가 초기화되지 않았습니다. 설정을 확인해주세요.');
                },
                async getUserTodos() {
                    throw new Error('Firebase가 초기화되지 않았습니다. 설정을 확인해주세요.');
                },
                onAuthStateChanged() {
                    return () => {};
                },
                async getServerStatus() {
                    return {
                        serverType: 'Firebase Firestore',
                        isConnected: false,
                        error: 'Firebase 초기화 실패',
                        note: '❌ Firebase 설정을 확인해주세요.'
                    };
                }
            };
        }
    </script>
</head>
<body>
    <!-- 메인 앱 화면 -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <header class="header">
                <h1>📝 Smart, Do-it!</h1>
                <div class="header-controls">
                    <!-- 로그인되지 않은 상태 -->
                    <div id="guestControls" class="auth-controls">
                        <button id="loginBtn" class="auth-btn-header">로그인</button>
                        <button id="registerBtn" class="auth-btn-header">회원가입</button>
                        <button id="forgotPasswordBtn" class="auth-btn-header forgot-btn-header">비밀번호 찾기</button>
                    </div>
                    
                    <!-- 로그인된 상태 -->
                    <div id="userInfo" class="user-info" style="display: none;">
                        <span id="userName"></span>
                        <button id="logoutBtn" class="logout-btn">로그아웃</button>
                    </div>
                    
                    <button id="themeToggleMain" class="theme-toggle">🌙</button>
                </div>
            </header>

        <div class="main-content">
            <!-- 뷰 전환 탭 -->
            <div class="view-tabs">
                <button id="listViewTab" class="view-tab active">📋 목록 보기</button>
                <button id="calendarViewTab" class="view-tab">📅 캘린더 보기</button>
            </div>

            <!-- 목록 뷰 -->
            <div id="listView" class="view-content active">
                <div class="input-section">
                    <form id="todoForm" class="todo-form">
                        <div class="input-group">
                            <input type="text" id="todoInput" placeholder="할 일을 입력하세요... (예: 내일 오후 3시 회의)">
                            <button type="submit" class="add-btn">추가</button>
                        </div>
                        <div class="task-options">
                            <select id="prioritySelect">
                                <option value="normal">일반</option>
                                <option value="high">높음 ⭐</option>
                                <option value="urgent">긴급 🔥</option>
                            </select>
                            <input type="date" id="dueDate" placeholder="마감일">
                            <select id="categorySelect">
                                <option value="general">일반</option>
                                <option value="work">업무</option>
                                <option value="personal">개인</option>
                                <option value="shopping">쇼핑</option>
                            </select>
                        </div>
                    </form>
                </div>
                
                <div class="todo-sections">
                    <div class="section">
                        <h2>📋 예정된 할 일</h2>
                        <div class="section-controls">
                            <button id="sortByPriority" class="sort-btn">우선순위순</button>
                            <button id="sortByDate" class="sort-btn">마감일순</button>
                        </div>
                        <ul id="pendingList" class="todo-list"></ul>
                    </div>
                    
                    <div class="section">
                        <h2>✅ 완료된 할 일</h2>
                        <div class="section-controls">
                            <button id="clearCompleted" class="clear-btn">완료 항목 모두 삭제</button>
                        </div>
                        <ul id="completedList" class="todo-list"></ul>
                    </div>
                </div>
            </div>

            <!-- 캘린더 뷰 -->
            <div id="calendarView" class="view-content">
                <div class="calendar-header">
                    <button id="prevMonth" class="nav-btn">◀</button>
                    <h2 id="currentMonthYear"></h2>
                    <button id="nextMonth" class="nav-btn">▶</button>
                </div>
                
                <div class="calendar-container">
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- 캘린더 그리드가 여기에 동적으로 생성됩니다 -->
                    </div>
                </div>
                
                <div class="selected-date-info" id="selectedDateInfo">
                    <h3 id="selectedDateTitle"></h3>
                    <div class="date-todos">
                        <div class="date-pending">
                            <h4>📋 예정된 할 일</h4>
                            <ul id="datePendingList"></ul>
                        </div>
                        <div class="date-completed">
                            <h4>✅ 완료된 할 일</h4>
                            <ul id="dateCompletedList"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 인증 모달 -->
    <div id="authModal" class="modal">
        <div class="modal-content auth-modal-content">
            <div class="modal-header">
                <h3 id="authModalTitle">로그인</h3>
                <button id="closeAuthModal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 로그인 폼 -->
                <div id="loginForm" class="auth-form-container">
                    <form class="auth-form">
                        <div class="form-group">
                            <label for="loginUsername">아이디</label>
                            <input type="text" id="loginUsername" placeholder="아이디를 입력하세요" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">비밀번호</label>
                            <input type="password" id="loginPassword" placeholder="비밀번호를 입력하세요" required>
                        </div>
                        <button type="submit" id="loginSubmitBtn" class="auth-btn">로그인</button>
                        <div class="auth-switch">
                            <span>계정이 없으신가요?</span>
                            <button type="button" id="showRegisterBtn" class="switch-btn">회원가입</button>
                        </div>
                        <div class="auth-switch">
                            <button type="button" id="showForgotPasswordBtn" class="forgot-btn">비밀번호를 잊으셨나요?</button>
                        </div>
                    </form>
                </div>

                <!-- 회원가입 폼 -->
                <div id="registerForm" class="auth-form-container" style="display: none;">
                    <form class="auth-form">
                        <div class="form-group">
                            <label for="registerUsername">아이디</label>
                            <input type="text" id="registerUsername" placeholder="아이디를 입력하세요" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">비밀번호</label>
                            <input type="password" id="registerPassword" placeholder="비밀번호를 입력하세요 (최소 4자)" required>
                            <small class="password-hint">비밀번호는 최소 4자 이상이어야 합니다.</small>
                        </div>
                        <div class="form-group">
                            <label for="registerConfirmPassword">비밀번호 확인</label>
                            <input type="password" id="registerConfirmPassword" placeholder="비밀번호를 다시 입력하세요" required>
                        </div>
                        <button type="submit" id="registerSubmitBtn" class="auth-btn">회원가입</button>
                        <div class="auth-switch">
                            <span>이미 계정이 있으신가요?</span>
                            <button type="button" id="showLoginBtn" class="switch-btn">로그인</button>
                        </div>
                    </form>
                </div>

                <!-- 비밀번호 찾기 폼 -->
                <div id="forgotPasswordForm" class="auth-form-container" style="display: none;">
                    <form class="auth-form">
                        <div class="form-group">
                            <label for="forgotUsername">아이디</label>
                            <input type="text" id="forgotUsername" placeholder="아이디를 입력하세요" required>
                        </div>
                        <button type="submit" id="forgotPasswordSubmitBtn" class="auth-btn">비밀번호 확인</button>
                        <div class="auth-switch">
                            <button type="button" id="backToLoginFromForgot" class="switch-btn">로그인으로 돌아가기</button>
                        </div>
                    </form>
                </div>

                <div id="authMessage" class="auth-message"></div>
            </div>
        </div>
    </div>

    <!-- 하위 작업 모달 -->
    <div id="subtaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>하위 작업 추가</h3>
                <button id="closeModal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="subtaskInput" placeholder="하위 작업을 입력하세요...">
                <button id="addSubtask" class="add-subtask-btn">추가</button>
                <ul id="subtaskList"></ul>
            </div>
        </div>
        </div>
    </div>

   <script src="./script.js" defer></script>-->
</body>
</html>

